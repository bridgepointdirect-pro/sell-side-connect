<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEC M&A Platform - Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    :root {
        --primary: #2563eb;
        --secondary: #10b981;
        --danger: #ef4444;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-600: #4b5563;
        --gray-800: #1f2937;
        --gray-900: #111827;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        line-height: 1.6;
        color: var(--gray-800);
        background: var(--gray-50);
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Login Screen */
    .login-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .login-box {
        background: white;
        border-radius: 12px;
        padding: 3rem;
        width: 100%;
        max-width: 450px;
        box-shadow: 0 20px 25px rgba(0,0,0,0.15);
    }

    .login-box h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: var(--gray-900);
        text-align: center;
    }

    .login-box p {
        text-align: center;
        color: var(--gray-600);
        margin-bottom: 2rem;
    }

    .login-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid var(--gray-200);
    }

    .login-tab {
        flex: 1;
        padding: 0.75rem;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-weight: 500;
        color: var(--gray-600);
        transition: all 0.2s;
    }

    .login-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }

    .login-form {
        display: none;
    }

    .login-form.active {
        display: block;
    }

    /* Hero */
    .hero {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 70vh;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        text-align: center;
        padding: 2rem 1rem;
    }

    .hero-content h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .hero-subhead {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        opacity: 0.95;
    }

    .hero-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .home-footer {
        background: white;
        padding: 3rem 1rem;
        text-align: center;
        border-top: 1px solid var(--gray-200);
    }

    .footer-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    /* Buttons */
    .btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        border: none;
        text-decoration: none;
        transition: all 0.2s;
        width: 100%;
    }

    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        width: auto;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background: #1e40af;
    }

    .btn-secondary {
        background: var(--secondary);
        color: white;
    }

    .btn-secondary:hover {
        background: #059669;
    }

    .btn-outline {
        background: white;
        color: var(--gray-800);
        border: 1px solid var(--gray-200);
    }

    .btn-outline:hover {
        background: var(--gray-50);
    }

    .btn-danger {
        background: var(--danger);
        color: white;
    }

    /* Header */
    .header {
        background: white;
        border-bottom: 1px solid var(--gray-200);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .header nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
        text-decoration: none;
        cursor: pointer;
    }

    .nav {
        display: flex;
        gap: 2rem;
        align-items: center;
    }

    .nav a {
        color: var(--gray-600);
        text-decoration: none;
        font-weight: 500;
        cursor: pointer;
    }

    .nav a.active {
        color: var(--primary);
        border-bottom: 2px solid var(--primary);
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-email {
        font-size: 0.875rem;
        color: var(--gray-600);
    }

    .logout-btn {
        font-size: 0.875rem;
        color: var(--primary);
        cursor: pointer;
        text-decoration: underline;
    }

    /* Toolbar */
    .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .toolbar-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    /* Kanban */
    .kanban {
        display: flex;
        gap: 1rem;
        overflow-x: auto;
        padding-bottom: 1rem;
    }

    .kanban-col {
        flex: 0 0 280px;
        background: var(--gray-100);
        border-radius: 8px;
        padding: 1rem;
        min-height: 400px;
    }

    .kanban-col h3 {
        font-size: 0.875rem;
        text-transform: uppercase;
        color: var(--gray-600);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--gray-200);
    }

    .kanban-cards {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .deal-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .deal-card:hover {
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }

    .deal-card h4 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    .deal-card p {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin-bottom: 0.25rem;
    }

    .tags {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .tag {
        font-size: 0.75rem;
        padding: 0.125rem 0.5rem;
        border-radius: 12px;
        background: var(--gray-200);
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        padding: 2rem;
        overflow-y: auto;
    }

    .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 8px;
        width: 100%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: var(--gray-600);
    }

    .modal-body {
        padding: 1.5rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-group label {
        display: block;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid var(--gray-200);
        border-radius: 4px;
        font-family: inherit;
        font-size: 1rem;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Checklist Layout */
    .checklist-layout {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .sidebar {
        position: sticky;
        top: 80px;
        height: fit-content;
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 1.5rem;
    }

    .sidebar h2 {
        margin-bottom: 1rem;
    }

    .sidebar nav a {
        display: block;
        padding: 0.5rem;
        color: var(--gray-600);
        text-decoration: none;
        border-radius: 4px;
        margin-bottom: 0.25rem;
        cursor: pointer;
    }

    .sidebar nav a:hover {
        background: var(--gray-100);
    }

    .sidebar nav a.complete {
        color: var(--secondary);
    }

    .main-content {
        min-height: 100vh;
    }

    .stage-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .stage-header {
        padding: 1.5rem;
        background: var(--gray-50);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .stage-header h3 {
        font-size: 1.25rem;
    }

    .stage-body {
        padding: 1.5rem;
    }

    .stage-body h4 {
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        color: var(--gray-800);
    }

    .stage-body ul {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }

    .checklist-items {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .checklist-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        background: var(--gray-50);
        border-radius: 4px;
    }

    .checklist-item input {
        width: 1.25rem;
        height: 1.25rem;
    }

    .checklist-item.checked label {
        text-decoration: line-through;
        color: var(--gray-600);
    }

    /* Toast */
    .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--gray-900);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 10px 15px rgba(0,0,0,0.2);
        opacity: 0;
        transform: translateY(100%);
        transition: all 0.3s;
        z-index: 2000;
    }

    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }

    .toast.success {
        background: var(--secondary);
    }

    .toast.error {
        background: var(--danger);
    }

    /* Print */
    @media print {
        .header, .sidebar, .toolbar, .toast {
            display: none !important;
        }
        .stage-body {
            display: block !important;
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-content h1 {
            font-size: 2rem;
        }
        .hero-actions {
            flex-direction: column;
            width: 100%;
        }
        .checklist-layout {
            grid-template-columns: 1fr;
        }
        .sidebar {
            position: static;
        }
        .login-box {
            padding: 2rem;
        }
    }

    /* Page visibility */
    .page {
        display: none;
    }
    .page.active {
        display: block;
    }

    .error-message {
        background: #fee;
        color: var(--danger);
        padding: 0.75rem;
        border-radius: 4px;
        margin-bottom: 1rem;
        font-size: 0.875rem;
    }
</style>
```

</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h1>AEC M&A Platform</h1>
                <p>Secure access for authorized users</p>

```
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">Login</button>
                <button class="login-tab" onclick="switchLoginTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="login-form active">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div id="loginError" class="error-message" style="display:none;"></div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="login-form">
                <form onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label>6-Digit Access Code</label>
                        <input type="text" id="accessCode" maxlength="6" pattern="[0-9]{6}" required placeholder="Enter 6-digit code">
                    </div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="signupUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signupPasswordConfirm" minlength="6" required>
                    </div>
                    <div id="signupError" class="error-message" style="display:none;"></div>
                    <button type="submit" class="btn btn-primary">Create Account</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- HOME PAGE -->
<div id="homePage" class="page">
    <header class="header">
        <nav class="container">
            <span class="logo" onclick="showPage('home')">AEC M&A</span>
            <div class="user-info">
                <span class="user-email" id="headerUserEmail"></span>
                <span class="logout-btn" onclick="logout()">Logout</span>
            </div>
        </nav>
    </header>

    <div class="hero">
        <div class="hero-content">
            <h1>AEC M&A Platform</h1>
            <p class="hero-subhead">Architecture, Engineering & Construction | $2M–$50M Deals</p>
            <div class="hero-actions">
                <button class="btn btn-primary" onclick="showPage('crm')">CRM</button>
                <button class="btn btn-secondary" onclick="showPage('checklist')">Checklist</button>
            </div>
        </div>
    </div>

    <footer class="home-footer">
        <div class="container">
            <h2>Data Management</h2>
            <p>Export and import your CRM data</p>
            <div class="footer-actions">
                <button class="btn btn-outline" onclick="exportData()">Export Data</button>
                <button class="btn btn-outline" onclick="document.getElementById('importFile').click()">Import Data</button>
                <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(event)">
            </div>
        </div>
    </footer>
</div>

<!-- CRM PAGE -->
<div id="crmPage" class="page">
    <header class="header">
        <nav class="container">
            <span class="logo" onclick="showPage('home')">AEC M&A</span>
            <div class="nav">
                <a onclick="showPage('crm')" class="active">CRM</a>
                <a onclick="showPage('checklist')">Checklist</a>
            </div>
            <div class="user-info">
                <span class="user-email" id="crmUserEmail"></span>
                <span class="logout-btn" onclick="logout()">Logout</span>
            </div>
        </nav>
    </header>

    <main class="container" style="padding: 2rem 1rem;">
        <div class="toolbar">
            <h1>Deal Pipeline</h1>
            <div class="toolbar-actions">
                <button class="btn btn-primary btn-sm" onclick="openDealModal(null)">+ New Deal</button>
                <button class="btn btn-outline btn-sm" onclick="exportCSV()">Export CSV</button>
            </div>
        </div>

        <div class="kanban" id="kanban"></div>
    </main>
</div>

<!-- CHECKLIST PAGE -->
<div id="checklistPage" class="page">
    <header class="header">
        <nav class="container">
            <span class="logo" onclick="showPage('home')">AEC M&A</span>
            <div class="nav">
                <a onclick="showPage('crm')">CRM</a>
                <a onclick="showPage('checklist')" class="active">Checklist</a>
            </div>
            <div class="user-info">
                <span class="user-email" id="checklistUserEmail"></span>
                <span class="logout-btn" onclick="logout()">Logout</span>
            </div>
        </nav>
    </header>

    <div class="checklist-layout">
        <aside class="sidebar">
            <h2>Stages</h2>
            <nav id="sideNav"></nav>
        </aside>

        <main class="main-content">
            <div class="toolbar">
                <h1>Deal Checklist</h1>
                <div class="toolbar-actions">
                    <button class="btn btn-outline btn-sm" onclick="window.print()">Print PDF</button>
                    <button class="btn btn-outline btn-sm" onclick="resetChecklist()">Reset</button>
                </div>
            </div>

            <div id="checklistContent"></div>
        </main>
    </div>
</div>

<!-- DEAL MODAL -->
<div class="modal" id="dealModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Deal Details</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    // ACCESS CODE - Change this to your desired 6-digit code
    const VALID_ACCESS_CODE = '206233';

    // Authentication State
    let currentUser = null;

    // Check if user is logged in on page load
    function initAuth() {
        const storedUser = localStorage.getItem('aec_current_user');
        if (storedUser) {
            currentUser = JSON.parse(storedUser);
            showMainApp();
        } else {
            document.getElementById('loginScreen').classList.add('active');
        }
    }

    // Switch between login and signup tabs
    function switchLoginTab(tab) {
        document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
        
        if (tab === 'login') {
            document.querySelector('.login-tab:first-child').classList.add('active');
            document.getElementById('loginForm').classList.add('active');
        } else {
            document.querySelector('.login-tab:last-child').classList.add('active');
            document.getElementById('signupForm').classList.add('active');
        }
    }

    // Handle Signup
    function handleSignup(event) {
        event.preventDefault();
        
        const code = document.getElementById('accessCode').value;
        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
        const errorDiv = document.getElementById('signupError');

        // Validate access code
        if (code !== VALID_ACCESS_CODE) {
            errorDiv.textContent = 'Invalid access code. Please contact your administrator.';
            errorDiv.style.display = 'block';
            return;
        }

        // Validate passwords match
        if (password !== passwordConfirm) {
            errorDiv.textContent = 'Passwords do not match.';
            errorDiv.style.display = 'block';
            return;
        }

        // Get existing users
        const users = JSON.parse(localStorage.getItem('aec_users') || '[]');

        // Check if email already exists
        if (users.find(u => u.email === email)) {
            errorDiv.textContent = 'An account with this email already exists.';
            errorDiv.style.display = 'block';
            return;
        }

        // Create new user
        const newUser = {
            id: Utils.generateId(),
            username: username,
            email: email,
            password: password, // In production, this should be hashed!
            createdAt: new Date().toISOString()
        };

        users.push(newUser);
        localStorage.setItem('aec_users', JSON.stringify(users));

        // Auto-login after signup
        currentUser = { email: newUser.email, username: newUser.username };
        localStorage.setItem('aec_current_user', JSON.stringify(currentUser));

        Utils.showToast('Account created successfully!', 'success');
        showMainApp();
    }

    // Handle Login
    function handleLogin(event) {
        event.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');

        // Get existing users
        const users = JSON.parse(localStorage.getItem('aec_users') || '[]');

        // Find user
        const user = users.find(u => u.email === email && u.password === password);

        if (!user) {
            errorDiv.textContent = 'Invalid email or password.';
            errorDiv.style.display = 'block';
            return;
        }

        // Login successful
        currentUser = { email: user.email, username: user.username };
        localStorage.setItem('aec_current_user', JSON.stringify(currentUser));

        Utils.showToast('Login successful!', 'success');
        showMainApp();
    }

    // Logout
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            currentUser = null;
            localStorage.removeItem('aec_current_user');
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show login screen
            document.getElementById('loginScreen').classList.add('active');
            
            // Clear login form
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            Utils.showToast('Logged out successfully', 'success');
        }
    }

    // Show main app after login
    function showMainApp() {
        document.getElementById('loginScreen').classList.remove('active');
        document.getElementById('homePage').classList.add('active');
        
        // Update user email in headers
        if (currentUser) {
            document.getElementById('headerUserEmail').textContent = currentUser.email;
            document.getElementById('crmUserEmail').textContent = currentUser.email;
            document.getElementById('checklistUserEmail').textContent = currentUser.email;
        }
    }

    // Utility functions
    const Utils = {
        generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9);
        },
        formatCurrency(num) {
            if (!num) return '$0';
            return '$' + (num / 1000000).toFixed(1) + 'M';
        },
        showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.className = 'toast show';
            if (type === 'success') toast.classList.add('success');
            if (type === 'error') toast.classList.add('error');
            setTimeout(() => toast.classList.remove('show'), 3000);
        },
        downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        },
        downloadCSV(rows, filename) {
            const csv = rows.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    };

    // Page Navigation
    function showPage(page) {
        // Check if user is logged in
        if (!currentUser) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('loginScreen').classList.add('active');
            return;
        }

        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page + 'Page').classList.add('active');
        if (page === 'crm') renderKanban();
        if (page === 'checklist') initChecklist();
    }

    // Export/Import
    function exportData() {
        const data = {
            deals: JSON.parse(localStorage.getItem('aec_deals') || '[]'),
            checklist: JSON.parse(localStorage.getItem('aec_checklist') || '{}'),
            exportDate: new Date().toISOString()
        };
        Utils.downloadJSON(data, 'aec-data.json');
        Utils.showToast('Data exported successfully', 'success');
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (data.deals) localStorage.setItem('aec_deals', JSON.stringify(data.deals));
                if (data.checklist) localStorage.setItem('aec_checklist', JSON.stringify(data.checklist));
                Utils.showToast('Data imported successfully', 'success');
            } catch (error) {
                Utils.showToast('Error importing data', 'error');
            }
            event.target.value = '';
        };
        reader.readAsText(file);
    }

    // CRM Functions
    const STAGES = ['Sourcing', 'NDA', 'CIM Shared', 'IOIs', 'LOI', 'Diligence', 'Closing', 'Post-Close'];
    let deals = [];
    let currentDeal = null;

    function loadDeals() {
        const stored = localStorage.getItem('aec_deals');
        if (stored) {
            deals = JSON.parse(stored);
        } else {
            deals = [
                {
                    id: Utils.generateId(),
                    name: 'BlueBeam Architects',
                    vertical: 'Architecture',
                    location: 'Seattle, WA',
                    revenue: 14200000,
                    ebitda: 2100000,
                    stage: 'CIM Shared',
                    notes: ''
                },
                {
                    id: Utils.generateId(),
                    name: 'Cascade Engineers',
                    vertical: 'Engineering',
                    location: 'Portland, OR',
                    revenue: 9800000,
                    ebitda: 1600000,
                    stage: 'Diligence',
                    notes: ''
                },
                {
                    id: Utils.generateId(),
                    name: 'Redline GC',
                    vertical: 'Construction',
                    location: 'Boise, ID',
                    revenue: 42000000,
                    ebitda: 4800000,
                    stage: 'Sourcing',
                    notes: ''
                }
            ];
            saveDeals();
        }
    }

    function saveDeals() {
        localStorage.setItem('aec_deals', JSON.stringify(deals));
    }

    function renderKanban() {
        loadDeals();
        const kanban = document.getElementById('kanban');
        kanban.innerHTML = '';
        
        STAGES.forEach(stage => {
            const col = document.createElement('div');
            col.className = 'kanban-col';
            col.innerHTML = `<h3>${stage}</h3><div class="kanban-cards"></div>`;
            
            const stageDeals = deals.filter(d => d.stage === stage);
            const cards = col.querySelector('.kanban-cards');
            
            stageDeals.forEach(deal => {
                const card = document.createElement('div');
                card.className = 'deal-card';
                card.innerHTML = `
                    <h4>${deal.name}</h4>
                    <p>${deal.location}</p>
                    <p>Rev: ${Utils.formatCurrency(deal.revenue)}</p>
                    <p>EBITDA: ${Utils.formatCurrency(deal.ebitda)}</p>
                    <div class="tags"><span class="tag">${deal.vertical}</span></div>
                `;
                card.onclick = () => openDealModal(deal.id);
                cards.appendChild(card);
            });
            
            kanban.appendChild(col);
        });
    }

    function openDealModal(dealId) {
        const modal = document.getElementById('dealModal');
        const title = document.getElementById('modalTitle');
        const body = document.getElementById('modalBody');
        
        if (dealId) {
            currentDeal = deals.find(d => d.id === dealId);
            title.textContent = currentDeal.name;
            body.innerHTML = `
                <form onsubmit="updateDeal(event)">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="dealName" value="${currentDeal.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Vertical</label>
                        <select id="dealVertical">
                            <option value="Architecture" ${currentDeal.vertical === 'Architecture' ? 'selected' : ''}>Architecture</option>
                            <option value="Engineering" ${currentDeal.vertical === 'Engineering' ? 'selected' : ''}>Engineering</option>
                            <option value="Construction" ${currentDeal.vertical === 'Construction' ? 'selected' : ''}>Construction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="dealLocation" value="${currentDeal.location}">
                    </div>
                    <div class="form-group">
                        <label>Revenue ($)</label>
                        <input type="number" id="dealRevenue" value="${currentDeal.revenue}" step="1000">
                    </div>
                    <div class="form-group">
                        <label>EBITDA ($)</label>
                        <input type="number" id="dealEbitda" value="${currentDeal.ebitda}" step="1000">
                    </div>
                    <div class="form-group">
                        <label>Stage</label>
                        <select id="dealStage">
                            ${STAGES.map(s => `<option value="${s}" ${currentDeal.stage === s ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="dealNotes" rows="4">${currentDeal.notes}</textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-danger" onclick="deleteDeal()">Delete</button>
                    </div>
                </form>
            `;
        } else {
            title.textContent = 'New Deal';
            body.innerHTML = `
                <form onsubmit="createDeal(event)">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="dealName" required>
                    </div>
                    <div class="form-group">
                        <label>Vertical</label>
                        <select id="dealVertical">
                            <option value="Architecture">Architecture</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Construction">Construction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="dealLocation">
                    </div>
                    <div class="form-group">
                        <label>Revenue ($)</label>
                        <input type="number" id="dealRevenue" step="1000">
                    </div>
                    <div class="form-group">
                        <label>EBITDA ($)</label>
                        <input type="number" id="dealEbitda" step="1000">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Deal</button>
                </form>
            `;
        }
        modal.classList.add('active');
    }

    function closeModal() {
        document.getElementById('dealModal').classList.remove('active');
        currentDeal = null;
    }

    function createDeal(e) {
        e.preventDefault();
        const newDeal = {
            id: Utils.generateId(),
            name: document.getElementById('dealName').value,
            vertical: document.getElementById('dealVertical').value,
            location: document.getElementById('dealLocation').value,
            revenue: parseFloat(document.getElementById('dealRevenue').value) || 0,
            ebitda: parseFloat(document.getElementById('dealEbitda').value) || 0,
            stage: 'Sourcing',
            notes: ''
        };
        deals.push(newDeal);
        saveDeals();
        renderKanban();
        closeModal();
        Utils.showToast('Deal created', 'success');
    }

    function updateDeal(e) {
        e.preventDefault();
        currentDeal.name = document.getElementById('dealName').value;
        currentDeal.vertical = document.getElementById('dealVertical').value;
        currentDeal.location = document.getElementById('dealLocation').value;
        currentDeal.revenue = parseFloat(document.getElementById('dealRevenue').value) || 0;
        currentDeal.ebitda = parseFloat(document.getElementById('dealEbitda').value) || 0;
        currentDeal.stage = document.getElementById('dealStage').value;
        currentDeal.notes = document.getElementById('dealNotes').value;
        saveDeals();
        renderKanban();
        closeModal();
        Utils.showToast('Deal updated', 'success');
    }

    function deleteDeal() {
        if (confirm('Delete this deal?')) {
            deals = deals.filter(d => d.id !== currentDeal.id);
            saveDeals();
            renderKanban();
            closeModal();
            Utils.showToast('Deal deleted', 'success');
        }
    }

    function exportCSV() {
        const rows = [['Company', 'Vertical', 'Location', 'Revenue', 'EBITDA', 'Stage']];
        deals.forEach(deal => {
            rows.push([deal.name, deal.vertical, deal.location, deal.revenue, deal.ebitda, deal.stage]);
        });
        Utils.downloadCSV(rows, 'aec-deals.csv');
        Utils.showToast('CSV exported', 'success');
    }

    // Checklist Functions
    const CHECKLIST_STAGES = [
        {
            id: 1, title: 'Sourcing & Intake',
            purpose: 'Initial engagement and conflict screening',
            inputs: ['Seller intro', 'Revenue/EBITDA', 'Vertical & geography'],
            outputs: ['Intake sheet', 'Engagement letter'],
            checklist: ['Verify licenses & bonding', 'Check union vs non-union', 'Review backlog/WIP', 'Safety metrics (EMR/TRIR)', 'Accounting method review']
        },
        {
            id: 2, title: 'NDA',
            purpose: 'Confidentiality agreement execution',
            inputs: ['NDA template', 'Party details'],
            outputs: ['Executed NDA', 'Buyer profile'],
            checklist: ['Route NDA for signature', 'Set up data room access', 'Watermark policy confirmed']
        },
        {
            id: 3, title: 'CIM',
            purpose: 'Comprehensive information package',
            inputs: ['3-5 year financials', 'Customer list', 'Project portfolio', 'Safety records'],
            outputs: ['CIM document', 'Data room index', 'Q&A log'],
            checklist: ['Compile financial statements', 'Organize WIP schedule', 'Document bonding capacity', 'Prepare org chart', 'Collect insurance certificates']
        },
        {
            id: 4, title: 'IOIs',
            purpose: 'Non-binding purchase indications',
            inputs: ['IOI template', 'Valuation guidance'],
            outputs: ['IOIs received', 'Bid comparison matrix'],
            checklist: ['Send IOI template to buyers', 'Set submission deadline', 'Build comparison matrix', 'Evaluate structure preferences']
        },
        {
            id: 5, title: 'Diligence',
            purpose: 'Deep dive verification',
            inputs: ['Diligence request list', 'Project files', 'Contracts'],
            outputs: ['Diligence tracker', 'Red flag list', 'QoE report'],
            checklist: ['Share data room v2', 'Organize site visits', 'Collect subcontractor agreements', 'Review change orders', 'Verify equipment liens', 'Confirm retainage balances']
        },
        {
            id: 6, title: 'LOI',
            purpose: 'Letter of intent with exclusivity',
            inputs: ['LOI template', 'Price/structure terms'],
            outputs: ['Executed LOI', 'Exclusivity period'],
            checklist: ['Negotiate key terms', 'Define purchase price', 'Set exclusivity period', 'Outline closing conditions', 'Notify legal counsel']
        },
        {
            id: 7, title: 'Closing',
            purpose: 'Transaction completion',
            inputs: ['Closing checklist', 'Funds flow'],
            outputs: ['Signed documents', 'Wire confirmations', 'Press release'],
            checklist: ['Execute all documents', 'Wire funds', 'Transfer titles/ownership', 'File necessary notices', 'Issue press announcement']
        },
        {
            id: 8, title: 'Post-Close',
            purpose: 'Integration and transition',
            inputs: ['Integration plan', 'TSA milestones'],
            outputs: ['30/60/90 plan', 'KPI dashboard'],
            checklist: ['Execute transition plan', 'Monitor TSA deliverables', 'Track integration KPIs', 'Regular governance meetings', 'Release escrow as appropriate']
        }
    ];

    let checklistState = {};

    function initChecklist() {
        loadChecklistState();
        renderSidebar();
        renderStages();
    }

    function loadChecklistState() {
        const stored = localStorage.getItem('aec_checklist');
        checklistState = stored ? JSON.parse(stored) : {};
    }

    function saveChecklistState() {
        localStorage.setItem('aec_checklist', JSON.stringify(checklistState));
    }

    function renderSidebar() {
        const nav = document.getElementById('sideNav');
        nav.innerHTML = CHECKLIST_STAGES.map(stage => {
            const isComplete = checklistState[`stage-${stage.id}-complete`];
            return `<a href="#stage-${stage.id}" class="${isComplete ? 'complete' : ''}">${stage.id}. ${stage.title}</a>`;
        }).join('');
    }

    function renderStages() {
        const content = document.getElementById('checklistContent');
        content.innerHTML = CHECKLIST_STAGES.map(stage => {
            const isComplete = checklistState[`stage-${stage.id}-complete`];
            return `
                <div class="stage-card" id="stage-${stage.id}">
                    <div class="stage-header" onclick="toggleStage(${stage.id})">
                        <h3>${stage.id}. ${stage.title}</h3>
                        <span>▼</span>
                    </div>
                    <div class="stage-body">
                        <p><strong>Purpose:</strong> ${stage.purpose}</p>
                        <h4>Inputs</h4>
                        <ul>${stage.inputs.map(i => `<li>${i}</li>`).join('')}</ul>
                        <h4>Outputs</h4>
                        <ul>${stage.outputs.map(o => `<li>${o}</li>`).join('')}</ul>
                        <h4>Checklist</h4>
                        <div class="checklist-items">
                            ${stage.checklist.map((item, idx) => {
                                const itemId = `${stage.id}-${idx}`;
                                const checked = checklistState[itemId] || false;
                                return `
                                    <div class="checklist-item ${checked ? 'checked' : ''}">
                                        <input type="checkbox" id="check-${itemId}" ${checked ? 'checked' : ''} 
                                               onchange="toggleChecklistItem('${itemId}')">
                                        <label for="check-${itemId}">${item}</label>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-${isComplete ? 'secondary' : 'primary'} btn-sm" 
                                    onclick="markStageComplete(${stage.id})">
                                ${isComplete ? '✓ Completed' : 'Mark Complete'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        renderSidebar();
    }

    function toggleStage(stageId) {
        const card = document.querySelector(`#stage-${stageId}`);
        const body = card.querySelector('.stage-body');
        body.style.display = body.style.display === 'none' ? 'block' : 'none';
    }

    function toggleChecklistItem(itemId) {
        checklistState[itemId] = !checklistState[itemId];
        saveChecklistState();
        renderStages();
    }

    function markStageComplete(stageId) {
        const stage = CHECKLIST_STAGES.find(s => s.id === stageId);
        const allChecked = stage.checklist.every((_, idx) => checklistState[`${stageId}-${idx}`]);
        if (!allChecked) {
            alert('Please complete all checklist items first');
            return;
        }
        checklistState[`stage-${stageId}-complete`] = new Date().toISOString();
        saveChecklistState();
        renderStages();
        Utils.showToast(`${stage.title} marked complete`, 'success');
    }

    function resetChecklist() {
        if (confirm('Reset all checklist progress?')) {
            checklistState = {};
            saveChecklistState();
            renderStages();
            Utils.showToast('Checklist reset', 'success');
        }
    }

    // Initialize on page load
    initAuth();
    loadDeals();
</script>
```

</body>
</html>