<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AEC M&A Platform</title>
  <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
  <!-- Login (shown if not authenticated) -->
  <div id="loginScreen" class="page">
    <div class="login-container">
      <div class="login-box" role="dialog" aria-labelledby="loginTitle">
        <h1 id="loginTitle">AEC M&A Platform</h1>
        <p>Secure access for authorized users</p>

        <div class="login-tabs" role="tablist">
          <button class="login-tab active" role="tab" aria-selected="true" onclick="switchLoginTab('login')">Login</button>
          <button class="login-tab" role="tab" aria-selected="false" onclick="switchLoginTab('signup')">Sign Up</button>
        </div>

        <div id="loginForm" class="login-form active">
          <form id="loginFormEl">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input type="email" id="loginEmail" required autocomplete="username">
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input type="password" id="loginPassword" required autocomplete="current-password">
            </div>
            <div id="loginError" class="error-message" style="display:none;"></div>
            <button type="submit" class="btn">Login</button>
          </form>
        </div>

        <div id="signupForm" class="login-form" aria-hidden="true">
          <form id="signupFormEl">
            <div class="form-group">
              <label for="accessCode">6-Digit Access Code</label>
              <input type="text" id="accessCode" maxlength="6" pattern="[0-9]{6}" required placeholder="Enter 6-digit code" inputmode="numeric">
            </div>
            <div class="form-group">
              <label for="signupUsername">Username</label>
              <input type="text" id="signupUsername" required autocomplete="nickname">
            </div>
            <div class="form-group">
              <label for="signupEmail">Email</label>
              <input type="email" id="signupEmail" required autocomplete="email">
            </div>
            <div class="form-group">
              <label for="signupPassword">Password</label>
              <input type="password" id="signupPassword" minlength="6" required autocomplete="new-password">
            </div>
            <div class="form-group">
              <label for="signupPasswordConfirm">Confirm Password</label>
              <input type="password" id="signupPasswordConfirm" minlength="6" required autocomplete="new-password">
            </div>
            <div id="signupError" class="error-message" style="display:none;"></div>
            <button type="submit" class="btn">Create Account</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Home (shown if authenticated) -->
  <div id="homePage" class="page">
    <header class="header">
      <nav class="container">
        <a class="logo" href="./index.html">AEC M&A</a>
        <div class="user-info">
          <span class="user-email" id="headerUserEmail"></span>
          <span class="logout-btn">Logout</span>
        </div>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-content">
        <h1>AEC M&A Platform</h1>
        <p class="hero-subhead">Architecture, Engineering & Construction | $2Mâ€“$50M Deals</p>
        <div class="hero-actions">
          <a class="btn" href="./crm.html" aria-label="Open CRM">CRM</a>
          <a class="btn btn-secondary" href="./checklist.html" aria-label="Open Checklist">Checklist</a>
        </div>
      </div>
    </section>

    <footer class="home-footer" aria-label="Data tools">
      <div class="container">
        <h2>Data Management</h2>
        <p>Export and import your CRM data</p>
        <div class="footer-actions">
          <button class="btn btn-outline" id="exportJsonBtn">Export Data (JSON)</button>
          <button class="btn btn-outline" id="importJsonBtn">Import Data</button>
          <input type="file" id="importFile" accept=".json" style="display:none">
        </div>
      </div>
    </footer>
  </div>

  <div id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script src="./assets/js/app.js"></script>
  <script>
    // Inline auth + page switcher specific to index.html
    const VALID_ACCESS_CODE = '123456'; // change if you like

    function switchLoginTab(tab){
      document.querySelectorAll('.login-tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.login-form').forEach(f=>f.classList.remove('active'));
      if (tab==='login'){
        document.querySelector('.login-tab:first-child').classList.add('active');
        document.getElementById('loginForm').classList.add('active');
      } else {
        document.querySelector('.login-tab:last-child').classList.add('active');
        document.getElementById('signupForm').classList.add('active');
      }
    }
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    function initIndex(){
      const u = JSON.parse(localStorage.getItem('aec_current_user')||'null');
      const params = new URLSearchParams(location.search);
      if (u && !params.get('login')){
        showPage('homePage');
        const email = u.email || u.username || '';
        const el=document.getElementById('headerUserEmail'); if (el) el.textContent=email;
      } else {
        showPage('loginScreen');
      }
      document.querySelectorAll('.logout-btn').forEach(b=> b.addEventListener('click', ()=>{
        if (confirm('Logout?')){
          localStorage.removeItem('aec_current_user');
          location.href='./index.html?login=1';
        }
      }));
      // Login
      document.getElementById('loginFormEl').addEventListener('submit', (e)=>{
        e.preventDefault();
        const email = (document.getElementById('loginEmail').value||'').trim().toLowerCase();
        const pw = document.getElementById('loginPassword').value;
        const err = document.getElementById('loginError'); err.style.display='none'; err.textContent='';
        const users = JSON.parse(localStorage.getItem('aec_users')||'[]');
        const user = users.find(u=>u.email===email && u.password===pw);
        if (!user){ err.textContent='Invalid email or password.'; err.style.display='block'; return; }
        localStorage.setItem('aec_current_user', JSON.stringify({email:user.email, username:user.username}));
        location.href = './index.html';
      });
      // Signup
      document.getElementById('signupFormEl').addEventListener('submit', (e)=>{
        e.preventDefault();
        const code = document.getElementById('accessCode').value.trim();
        const username = document.getElementById('signupUsername').value.trim();
        const email = document.getElementById('signupEmail').value.trim().toLowerCase();
        const pw = document.getElementById('signupPassword').value;
        const pw2 = document.getElementById('signupPasswordConfirm').value;
        const err = document.getElementById('signupError'); err.style.display='none'; err.textContent='';
        if (code !== VALID_ACCESS_CODE){ err.textContent='Invalid access code.'; err.style.display='block'; return; }
        if (pw !== pw2){ err.textContent='Passwords do not match.'; err.style.display='block'; return; }
        if (!email || !username || pw.length < 6){ err.textContent='Enter valid username/email and a 6+ char password.'; err.style.display='block'; return; }
        const users = JSON.parse(localStorage.getItem('aec_users')||'[]');
        if (users.find(u=>u.email===email)){ err.textContent='Email already exists.'; err.style.display='block'; return; }
        users.push({ id:'_'+Math.random().toString(36).slice(2,10), username, email, password:pw, createdAt:new Date().toISOString() });
        localStorage.setItem('aec_users', JSON.stringify(users));
        localStorage.setItem('aec_current_user', JSON.stringify({email, username}));
        location.href = './index.html';
      });
      // Export/Import
      document.getElementById('exportJsonBtn').addEventListener('click', APP.exportData);
      document.getElementById('importJsonBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
      document.getElementById('importFile').addEventListener('change', APP.importData);
    }
    document.addEventListener('DOMContentLoaded', initIndex);
  </script>
</body>
</html>
